 %all the packages
\usepackage{gitinfo2}   % git information on the title page
\usepackage[backend=biber,style=alphabetic, dateabbrev=false, urldate=long]{biblatex} %for bibliography
\usepackage{amsmath, amssymb, amsthm, mathtools}      % general math stuff
\usepackage{mathrsfs}
\usepackage{extarrows}  % xlongrightarrow
\usepackage{mathdots}
\usepackage{stmaryrd} % bigsqcap
\usepackage{textcomp} % star symbol
\usepackage{thmtools} % resume theorem environments
\usepackage{fontspec} % for font stuff
\usepackage[british]{babel}
\usepackage{tikzpagenodes}  % to include an image at the right position
\usepackage{tikz-cd}    % commutative diagrams
\usetikzlibrary{positioning}
\usetikzlibrary{arrows,arrows.meta}
\usetikzlibrary{decorations.pathmorphing}
\usepackage{enumitem}   % more control over enumerates
\usepackage[automark,headsepline,autooneside=false]{scrlayer-scrpage}  %for headers
\usepackage{csquotes}   % for proper quotation marks
\usepackage{microtype}  % for better typography
\usepackage{xhfill}
\usepackage{alphalph}
\usepackage[original]{imakeidx} % for the index, load before hyperref
\usepackage{hyperref}   % for internal (and external) links
\usepackage[capitalise,noabbrev]{cleveref}  % for smarter referencing, load after hyperref



% the file for the refercences
\addbibresource{references.bib}


% more space for page numbers in the index, default is 1.55
\renewcommand{\@pnumwidth}{2em}


% no unplaned surprises with \cite
\DeclareFieldFormat{postnote}{#1}
\DeclareFieldFormat{multipostnote}{#1}


% for the index
\makeindex


% don't reset section counters between chapters
\counterwithout{section}{chapter}


% fonts for titlepage
\setkomafont{publishers}{\normalsize}


% prevents breaking inline math around binary or relationship symbols
\binoppenalty=\maxdimen
\relpenalty=\maxdimen


% settings for scrlayer-scrpage
\ihead{\leftmark}
\chead{}
\ohead{\rightmark}


% table of contents
\setcounter{tocdepth}{1}  % no subsections in the toc


% colours for hyperref
\hypersetup{
    colorlinks,
    linkcolor={green!35!black},
    citecolor={blue!50!black},
    urlcolor={blue!80!black}
}


% marking end of lectures
\newcommand{\textline}[1]{\noindent\xrfill[0.7ex]{0.4pt} #1 \xrfill[0.7ex]{0.4pt}}
\newcommand{\boxline}[1]{\textline{\fbox{#1}}}
\newcommand{\lecturend}[1]{\boxline{End of lecture #1}}


% settings for list like environments
\setlist[enumerate, 1]{leftmargin=*, align=left, label=\roman*)}
\setlist[enumerate, 2]{leftmargin=*, align=left, label=\alph*)}
\setlist[description, 1]{leftmargin=\labelwidth, font=\normalfont}
\setlist[description, 2]{leftmargin=\labelwidth, font=\normalfont}
\setlist[itemize, 1]{leftmargin=*}
\setlist[itemize, 2]{leftmargin=*, label={\textopenbullet}}
\setlist[itemize, 3]{leftmargin=*}


%%% theorem like environments
% counters
\newcounter{everything}[chapter]
\newcounter{extra}[chapter]
% printing of counters, needs to be defined before
\renewcommand{\theeverything}{\thechapter.\arabic{everything}}
\renewcommand{\theextra}{\arabic{chapter}.\AlphAlph{\value{extra}}}
% symbol for extra environments
\newcommand{\extrasymbol}{\textborn}
% theoremstyle
\theoremstyle{definition}
% actual environments
\declaretheorem[numbered=no,name=Claim]{claimnonum}
\declaretheorem[numbered=no,name=Convention]{conventionnonum}
\declaretheorem[sibling=everything]{corollary}
\declaretheorem[sibling=everything]{definition}
\declaretheorem[sibling=extra,name=Definition\textsuperscript{\extrasymbol}]{definition*}
\declaretheorem[numbered=no,name=Definition]{definitionnonum}
\declaretheorem[sibling=everything]{example}
\declaretheorem[sibling=extra,name=Example\textsuperscript{\extrasymbol}]{example*}
\declaretheorem[numbered=no,name=Example]{examplenonum}
\declaretheorem{fact}
\declaretheorem[sibling=everything]{lemma}
\declaretheorem[sibling=extra,name=Lemma\textsuperscript{\extrasymbol}]{lemma*}
\declaretheorem[sibling=extra,name=Notation\textsuperscript{\extrasymbol}]{notation*}
\declaretheorem[numbered=no,name=Notation]{notationnonum}
\declaretheorem[sibling=everything]{proposition}
\declaretheorem[sibling=extra,name=Proposition]{proposition*}
\declaretheorem[sibling=everything]{remark}
\declaretheorem[sibling=extra,name=Remark\textsuperscript{\extrasymbol}]{remark*}
\declaretheorem[numbered=no,name=Remark]{remarknonum}
\declaretheorem[sibling=everything,name=Remark-Definition]{remarkdefinition}
\declaretheorem[sibling=everything]{theorem}
\declaretheorem[sibling=extra,name=Warning\textsuperscript{\extrasymbol}]{warning*}
\renewcommand{\thmcontinues}[1]{Continued}


% reset equation counters between sections
\counterwithin*{equation}{section}


% how counters are printed
% for everything and extra see above
\setcounter{secnumdepth}{0}
\renewcommand{\thechapter}{\arabic{chapter}}
\renewcommand{\thefigure}{\thechapter.\arabic{figure}}
\renewcommand{\theequation}{\thechapter.\arabic{equation}}


% often used commands
\newcommand{\mc}{\mathcal}
\newcommand{\mf}{\mathfrak}


% text shortcuts
\newcommand{\dash}[2]{#1\nobreakdash-#2}
\newcommand{\fd}{finite\nobreakdash-dimensional}
\newcommand{\kalg}{$\kf$\nobreakdash-algebra}
\newcommand{\kalgs}{$\kf$\nobreakdash-algebras}
\newcommand{\kbilin}{$\kf$\nobreakdash-bilinear}
\newcommand{\klin}{$\kf$\nobreakdash-linear}
\newcommand{\kdash}{$\kf$\nobreakdash-}
\newcommand{\preklin}{pre\nobreakdash-$\kf$\nobreakdash-linear}
\newcommand{\qic}{quasi\nobreakdash-isomorphic}
\newcommand{\qim}{quasi\nobreakdash-isomorphism}
\newcommand{\qims}{quasi\nobreakdash-isomorphisms}
\newcommand{\twosided}{two\nobreakdash-sided}
\newcommand{\welldef}{well\nobreakdash-defined}
\newcommand{\Zbilin}{$\Integer$\nobreakdash-bilinear}
% with arguments
\newcommand{\balanced}[1]{#1\nobreakdash-balanced}
\newcommand{\simplex}[1]{#1\nobreakdash-simplex}
\newcommand{\simplices}[1]{#1\nobreakdash-simplices}
% kind of modules and stuff
\NewDocumentCommand{\indmodule}{O{} m O{}}{%
  {}_{#1} #2_{#3}
}
\NewDocumentCommand{\module}{m o}{%
  \IfNoValueTF{#2}{{#1}\nobreakdash-module}
                  {{#1}\nobreakdash-{#2}\nobreakdash-bimodule}%
}
\NewDocumentCommand{\modules}{m o}{%
  \IfNoValueTF{#2}{{#1}\nobreakdash-modules}
                  {{#1}\nobreakdash-{#2}\nobreakdash-bimodules}%
}
\NewDocumentCommand{\submodule}{m o}{%
  \IfNoValueTF{#2}{{#1}\nobreakdash-submodule}
                  {{#1}\nobreakdash-{#2}\nobreakdash-bisubmodule}%
}
\NewDocumentCommand{\submodules}{m o}{%
  \IfNoValueTF{#2}{{#1}\nobreakdash-submodules}
                  {{#1}\nobreakdash-{#2}\nobreakdash-bisubmodules}%
}


% binary operators
\newcommand{\tensor}{\otimes}
\newcommand{\dcup}{\amalg}
\newcommand{\dsum}{\oplus}
\newcommand{\bigdsum}{\bigoplus}
\newcommand{\hd}{\mathbin{:}}


% math shortcuts
\newcommand{\bpp}{{}^{\backprime \backprime}}
\newcommand{\bp}{{}^{\backprime}}
\newcommand{\codiag}{\nabla}
\newcommand{\defined}{\coloneqq}
\newcommand{\defines}{\eqqcolon}
\newcommand{\del}{\partial}
\newcommand{\diag}{\Delta}
\newcommand{\inA}{\in_\Acat}
\newcommand{\xfrom}{\xleftarrow}
\newcommand{\xto}{\xrightarrow}
\newcommand{\xlongfrom}{\xlongleftarrow}
\newcommand{\xlongto}{\xlongrightarrow}
\newcommand{\longto}{\longrightarrow}
\newcommand{\inclusion}{\hookrightarrow}
\newcommand{\pb}{\lrcorner}
\newcommand{\projection}{\twoheadrightarrow}
\newcommand{\po}{\ulcorner}


% numbers and fields
\newcommand{\kf}{\mathbf{k}}
\newcommand{\Natural}{\mathbb{N}}
\newcommand{\Integer}{\mathbb{Z}}
\newcommand{\Rational}{\mathbb{Q}}
\newcommand{\Real}{\mathbb{R}}
\newcommand{\Complex}{\mathbb{C}}
\newcommand{\Finite}{\mathbb{F}}


% font choices
\newcommand{\catname}[1]{\mathbf{#1}}
\newcommand{\gencat}[1]{\mathcal{#1}}
\newcommand{\sheaf}[1]{\mathscr{#1}}

% categories
% fixed categories
\newcommand{\Ab}{\catname{Ab}}
\newcommand{\Ch}{\cc{\catname{Ch}}}
\newcommand{\CCh}{\ccc{\catname{Ch}}}
\newcommand{\CommRing}{\catname{CRing}}
\newcommand{\Conn}{\catname{Conn}}
\newcommand{\Field}{\catname{Field}}
\newcommand{\Fun}{\catname{Fun}}
\newcommand{\Group}{\catname{Grp}}
\newcommand{\Haus}{\catname{Haus}}
\newcommand{\kAlg}{\text{$\kf$-$\catname{Alg}$}}
\newcommand{\kCommAlg}{\text{$\kf$-$\catname{CAlg}$}}
\newcommand{\Mor}{\catname{Mor}}
\newcommand{\Path}{\catname{Path}}
\newcommand{\Presheaf}{\catname{PSh}}
\newcommand{\Rep}[2]{\catname{Rep}_{#1}(#2)}
\newcommand{\Ring}{\catname{Ring}}
\newcommand{\Set}{\catname{Set}}
\newcommand{\Sheaf}{\catname{Sh}}
\newcommand{\Top}{\catname{Top}}
% generaic categories
\newcommand{\Acat}{\gencat{A}}
\newcommand{\Bcat}{\gencat{B}}
\newcommand{\Ccat}{\gencat{C}}
\newcommand{\Dcat}{\gencat{D}}
\newcommand{\Ecat}{\gencat{E}}
\newcommand{\Fcat}{\gencat{F}}
\newcommand{\Gcat}{\gencat{G}}
\newcommand{\Pcat}{\gencat{P}}
\newcommand{\Rcat}{\gencat{R}}
\newcommand{\Scat}{\gencat{S}}
\newcommand{\Tcat}{\gencat{T}}
\newcommand{\Xcat}{\gencat{X}}
% more complicated constructions
\newcommand{\Mod}{\catname{Mod}}
\newcommand{\Modl}[1]{\text{$#1$-$\Mod$}}
\newcommand{\Modlfd}[1]{\text{$#1$-$\catname{mod}$}}
\newcommand{\Modlfg}[1]{\text{$#1$-$\Mod^\fg$}}
\newcommand{\Modr}[1]{\text{$\Mod$-$#1$}}
\newcommand{\Modrfd}[1]{\text{$\catname{mod}$-$#1$}}
\newcommand{\Modrfg}[1]{\text{$\Mod^\fg$-$#1$}}


% sheafes
\newcommand{\Cs}{\sheaf{C}}
\newcommand{\Fs}{\sheaf{F}}
\newcommand{\Gs}{\sheaf{G}}
\newcommand{\Hs}{\sheaf{H}}


% chain complexes
\newcommand{\chainsymbol}{\bullet}
\newcommand{\cc}[1]{#1_\chainsymbol}
\newcommand{\ccc}[1]{#1^\chainsymbol}
\newcommand{\Bcc}{\cc{B}}
\newcommand{\Ccc}{\cc{C}}
\newcommand{\Dcc}{\cc{D}}
\newcommand{\Ecc}{\cc{E}}
\newcommand{\Fcc}{\cc{F}}
\newcommand{\Zcc}{\cc{Z}}
\newcommand{\Bccc}{\ccc{B}}
\newcommand{\Cccc}{\ccc{C}}
\newcommand{\Dccc}{\ccc{D}}
\newcommand{\Zccc}{\ccc{Z}}

% spaces and sets
\DeclareMathOperator{\Bl}{B}
\DeclareMathOperator{\coim}{coim}
\DeclareMathOperator{\Coker}{Coker}
\DeclareMathOperator{\coker}{coker}
\DeclareMathOperator{\conv}{conv}
\newcommand{\cont}{\sheaf{C}}
\DeclareMathOperator{\End}{End}
\DeclarePairedDelimiter{\gen}{\langle}{\rangle}
\DeclarePairedDelimiter{\genideal}{(}{)}
\DeclareMathOperator{\GL}{GL}
\DeclareMathOperator{\Hl}{H}
\DeclareMathOperator{\Hom}{Hom}
\DeclareMathOperator{\im}{im}
\DeclareMathOperator{\Ker}{Ker}
\newcommand{\mat}[2]{\operatorname{M}_{#1 \times #1}(#2)}
\DeclareMathOperator{\Ob}{Ob}
\newcommand{\triag}[2]{\operatorname{T}_{#1}(#2)}
\DeclareMathOperator{\ringcenter}{Z}
\newcommand{\sphere}{\mathbb{S}}
\DeclareMathOperator{\Zl}{Z}


% functions and functors
\DeclareMathOperator{\ringchar}{char}
\newcommand{\ev}{\mathrm{ev}}
\newcommand{\Id}{\mathrm{Id}}
\DeclareMathOperator{\id}{id}
\DeclareMathOperator{\power}{P}


% decorations
\DeclarePairedDelimiter{\card}{\lvert}{\rvert}
\DeclarePairedDelimiter{\class}{[}{]}
\newcommand{\closure}[1]{\overline{#1}}
\newcommand{\fg}{\mathrm{fg}}
\newcommand{\op}{\mathrm{op}}
\newcommand{\sing}{{\,\mathrm{sing}}}

% custom macros with case distinctions
\NewDocumentCommand{\suchthat}{s}{
  \IfBooleanTF{#1}
    {\,\middle|\,}
    {\mathrel{|}}       
}
\NewDocumentCommand{\restrict}{smmO{}}{
  \IfBooleanTF{#1}
    {\left. {#2} \middle|_{#3}^{#4} \right.}
    {{#2} |_{#3}^{#4}}
}


% copied from https://tex.stackexchange.com/questions/198771/align-in-substack
\newcommand{\subalign}[1]{%
  \vcenter{%
    \Let@ \restore@math@cr \default@tag
    \baselineskip\fontdimen10 \scriptfont\tw@
    \advance\baselineskip\fontdimen12 \scriptfont\tw@
    \lineskip\thr@@\fontdimen8 \scriptfont\thr@@
    \lineskiplimit\lineskip
    \ialign{\hfil$\m@th\scriptstyle##$&$\m@th\scriptstyle{}##$\crcr
      #1\crcr
    }%
  }
}




